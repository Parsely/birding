#!/bin/bash
# Download and unpack kafka.

. $NIXD_LIB/apache.sh
. $NIXD_LIB/java.sh

SCALA_VERSION=2.10
KAFKA_VERSION=0.8.2.1
#UNPACKED=kafka_$SCALA_VERSION-$KAFKA_VERSION
#Use a SNAPSHOT build instead:
UNPACKED=kafka_2.10-0.8.3-SNAPSHOT
ARCHIVE=$UNPACKED.tgz
MD5SUM=16cbbdf77c5e2e17aa469f4430ff51a4

DESTINATION=$NIXD_OPT/kafka

check() {
    nixd_ls $DESTINATION
}

resources() {
    #local url=`locate_apache_mirror /kafka/$KAFKA_VERSION/$ARCHIVE`
    #Use a SNAPSHOT build instead:
    local url='https://github.com/rduplain/build/raw/birding/kafka_2.10-0.8.3-SNAPSHOT-c8e62c9.tgz'
    echo $url $ARCHIVE md5 $MD5SUM
}

pretest() {
    check_java_version
}

install() {
    rm -fr $UNPACKED $DESTINATION
    tar -xzf $ARCHIVE
    mv -v $UNPACKED $DESTINATION
}

nixd_run "$@"
